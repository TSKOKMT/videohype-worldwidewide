<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Grid Layout</title>

        <style>
            body,
            html {
                margin: 0;
                padding: 0;
            }

            .box {
                position: absolute;
                width: 24%;
                height: 24%;
                transform: translate(-50%, -50%);
                background-color: transparent;
                border: 1px solid #000000;
            }

            #container {
                position: fixed;
                width: 100vw;
                height: 100vh;
            }

            iframe {
                width: 200%;
                height: 200%;
                transform: scale(0.5);
                transform-origin: 0 0;
                border: none;
            }

            a {
                position: absolute;
                display: block;
                width: 100%;
                height: 100%;
            }

            img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            #myButton {
                position: absolute;
                top: 10px;
                left: 10px;
                width: 7vw;
                height: 2vw;
            }

            #homeButton {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 7vw;
                height: 2vw;
            }
        </style>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const container = document.getElementById('container');
                container.style.backgroundColor = getRandomColor();

                const boxes = document.getElementsByClassName('box');
                for (let i = 0; i < boxes.length; i++) {
                    let bOk;
                    let whileCount = 0;
                    do {
                        const randomX = randomR(12, 100 - 12);
                        const randomY = randomR(12, 100 - 12);
                        boxes[i].style.left = `${randomX}%`;
                        boxes[i].style.top = `${randomY}%`;
                        //Check
                        bOk = true;
                        for (let j = 0; j < i; j++) {
                            if (isOverlapping(boxes[i], boxes[j])) {
                                bOk = false;
                                break;
                            }
                        }
                        whileCount++;
                    } while (whileCount < 1000 && !bOk)
                }

                const iframes = document.getElementsByTagName('iframe');
                for (let i = 0; i < iframes.length; i++) {
                    let theScale = 1920 / iframes[i].clientWidth;
                    iframes[i].style.width = theScale * 100 + '%';
                    iframes[i].style.height = theScale * 100 + '%';
                    iframes[i].style.transform = 'scale(' + (1 / theScale) + ')';
                }

                const socket = io({
                    query: {
                        appId: 'infinityRect'
                    }
                });

                //boxes[1].innerHTML = sessionStorage.getItem('content');
                socket.emit('pleaseContent', '');
                socket.on('content', (content) => {
                    boxes[0].innerHTML = content;
                });

                const button = document.getElementById('myButton');
                button.addEventListener('click', function () {
                    const content = container.innerHTML;
                    console.log(content);
                    //sessionStorage.setItem('content', content);
                    socket.emit('content', content);

                    window.location.href = 'index.html';
                });
            });

            function loop() {
                const boxes = document.getElementsByClassName('box');
                for (let i = 0; i < boxes.length; i++) {
                    boxes[i].style.fontSize = boxes[i].clientHeight / 12 + 'px';
                }

                requestAnimationFrame(loop);
            }
            requestAnimationFrame(loop);

            function randomR(min, max) {
                return Math.random() * (max - min) + min;
            }

            function getRandomColor() {
                const h = Math.floor(Math.random() * 360);
                const s = Math.floor(randomR(90, 100));
                const l = Math.floor(randomR(50, 60));
                return `hsl(${h},${s}%,${l}%)`;
            }

            function isOverlapping(box1, box2) {
                const rect1 = box1.getBoundingClientRect();
                const rect2 = box2.getBoundingClientRect();

                return !(rect1.right < rect2.left ||
                    rect1.left > rect2.right ||
                    rect1.bottom < rect2.top ||
                    rect1.top > rect2.bottom);
            }
        </script>
    </head>

    <body>
        <div id="container">
            <div class="box">1</div>
            <div class="box">
                <a href="https://en.wikipedia.org/wiki/Internet"></a>
                <iframe src="https://en.wikipedia.org/wiki/Internet"></iframe>
            </div>
            <div class="box">
                <a href="https://youtu.be/7UXwhIQsYXY"></a>
                <img src="../asset/3d/12.gif">
            </div>
            <div class="box">
                <a href="https://www.google.com"></a>
                <img src="../asset/3d/19.gif">
            </div>
            <div class="box">
                <a href="https://scrapbox.io/videohype2000/"></a>
                <img src="../asset/3d/16.gif">
            </div>
            <div class="box">
                <a href="https://toroymoi.com"></a>
                <iframe src="https://toroymoi.com"></iframe>
            </div>
        </div>
        <button id="myButton">クリックしてね</button>
        <button id="homeButton" href="../index.html">HOME</button>
    </body>

</html>