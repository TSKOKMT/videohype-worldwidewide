<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Grid Layout</title>

        <style>
            body,
            html {
                margin: 0;
                padding: 0;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 20px;
            }

            .box {
                position: absolute;
                width: 24%;
                height: 24%;
                /*transform: translate(-50%, -50%);*/
                background-color: transparent;
                border: 4px solid #ff00ff;
                border-radius: 10%;
                overflow: hidden;
            }

            #container {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            iframe {
                width: 200%;
                height: 200%;
                transform: scale(0.5);
                transform-origin: 0 0;
                border: none;
            }

            a {
                position: absolute;
                display: block;
                width: 100%;
                height: 100%;
            }

            img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            button {
                position: absolute;
                width: 18vh;
                height: 6vh;
                border-radius: 12px;
                font-size: 20px;
            }

            #myButton {
                top: 10px;
                left: 10px;
            }

            #reloadButton {
                top: 10px;
                left: calc(10px + 18vh + 10px);
            }

            #homeButton {
                top: 10px;
                right: 10px;
            }
        </style>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const container = document.getElementById('container');
                setRandomGradient(container);

                const boxes = document.getElementsByClassName('box');
                for (let i = 0; i < boxes.length; i++) {
                    let bOk;
                    let whileCount = 0;
                    do {
                        const randomW = randomR(20, 40);
                        const randomH = randomR(20, 40);
                        const randomX = randomR(0, 100 - randomW);
                        const randomY = randomR(0, 100 - randomH);
                        boxes[i].style.width = `${randomW}%`;
                        boxes[i].style.height = `${randomH}%`;
                        boxes[i].style.left = `${randomX}%`;
                        boxes[i].style.top = `${randomY}%`;
                        //Check
                        bOk = true;
                        for (let j = 0; j < i; j++) {
                            if (isOverlapping(boxes[i], boxes[j])) {
                                bOk = false;
                                break;
                            }
                        }
                        whileCount++;
                    } while (whileCount < 1000 && !bOk)
                }

                resizeIframes();
                resizeBoxBorderRadius();

                const socket = io({
                    query: {
                        appId: 'infinityRect'
                    }
                });

                //boxes[1].innerHTML = sessionStorage.getItem('content');
                socket.emit('pleaseContent', '');
                socket.on('content', (content) => {
                    boxes[0].innerHTML = content;

                    resizeIframes();
                    resizeBoxBorderRadius();
                });

                const button = document.getElementById('myButton');
                button.addEventListener('click', function () {
                    const content = container.outerHTML;
                    console.log(content);
                    //sessionStorage.setItem('content', content);
                    socket.emit('content', content);

                    window.location.href = 'index.html';
                });
            });

            function loop() {
                const boxes = document.getElementsByClassName('box');
                for (let i = 0; i < boxes.length; i++) {
                    boxes[i].style.fontSize = boxes[i].clientHeight / 12 + 'px';
                }

                requestAnimationFrame(loop);
            }
            requestAnimationFrame(loop);

            function randomR(min, max) {
                return Math.random() * (max - min) + min;
            }

            function getRandomColor() {
                const h = Math.floor(Math.random() * 360);
                /*const s = Math.floor(randomR(90, 100));
                const l = Math.floor(randomR(50, 60));*/
                const s = Math.floor(randomR(60, 100));
                const l = Math.floor(randomR(50, 90));
                return `hsl(${h},${s}%,${l}%)`;
            }

            function setRandomGradient(element) {
                // 5つのランダムな色を生成
                const color1 = getRandomColor();
                const color2 = getRandomColor();
                const color3 = getRandomColor();
                const color4 = getRandomColor();
                const color5 = getRandomColor();
                const angle = Math.floor(Math.random() * 360); // グラデーションの角度もランダムに決定
                const type = Math.random() > 0.5 ? 'linear-gradient' : 'radial-gradient';
                let gradient;

                if (type === 'linear-gradient') {
                    gradient = `${type}(${angle}deg, ${color1}, ${color2}, ${color3}, ${color4}, ${color5})`;
                } else {
                    gradient = `${type}(circle, ${color1} 20%, ${color2} 40%, ${color3} 60%, ${color4} 80%, ${color5} 100%)`;
                }

                element.style.backgroundImage = gradient;
            }

            function isOverlapping(box1, box2) {
                const rect1 = box1.getBoundingClientRect();
                const rect2 = box2.getBoundingClientRect();

                return !(rect1.right < rect2.left ||
                    rect1.left > rect2.right ||
                    rect1.bottom < rect2.top ||
                    rect1.top > rect2.bottom);
            }

            function resizeIframes() {
                const iframes = document.getElementsByTagName('iframe');
                for (let i = 0; i < iframes.length; i++) {
                    let theScale = 1920 / iframes[i].clientWidth;
                    iframes[i].style.width = theScale * 100 + '%';
                    iframes[i].style.height = theScale * 100 + '%';
                    iframes[i].style.transform = 'scale(' + (1 / theScale) + ')';
                }
            }

            function resizeBoxBorderRadius() {
                const boxes = document.getElementsByClassName('box');
                for (let i = 0; i < boxes.length; i++) {
                    const theParent = boxes[i].parentNode;
                    const theRadius = Math.sqrt(theParent.clientWidth * theParent.clientHeight) / 24;
                    boxes[i].style.borderRadius = theRadius + 'px';
                    if (i == 0) boxes[i].style.border = (theRadius / 2) + 'px solid #ff00ff;';
                    else boxes[i].style.border = (theRadius / 2) + 'px solid #000000;';
                }
            }
        </script>
    </head>

    <body>
        <div id="container">
            <div class="box">1</div>
            <div class="box">
                <a href="https://en.wikipedia.org/wiki/Internet"></a>
                <iframe src="https://en.wikipedia.org/wiki/Internet"></iframe>
            </div>
            <div class="box">
                <a href="https://youtu.be/7UXwhIQsYXY"></a>
                <img src="../asset/3d/12.gif">
            </div>
            <div class="box">
                <a href="https://scrapbox.io/videohype2000/"></a>
                <img src="../asset/3d/16.gif">
            </div>
            <div class="box">
                <a href="https://toroymoi.com"></a>
                <iframe src="https://toroymoi.com"></iframe>
            </div>
        </div>
        <button id="myButton">クリックしてね</button>
        <button id="reloadButton" onclick="location.href='./index.html';">再生成</button>
        <button id="homeButton" onclick="location.href='../index.html';">HOME</button>
    </body>

</html>